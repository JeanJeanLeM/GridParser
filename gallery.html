<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grid gallery – Imagine</title>
  <link rel="stylesheet" href="css/shared.css">
  <script src="js/gridSchema.js"></script>
  <style>
    body {
      font-family: var(--font-sans);
      margin: 0;
      min-height: 100vh;
      background: var(--page-bg);
    }
    .hero {
      text-align: center;
      margin-bottom: var(--section-gap);
    }
    .hero__label {
      font-size: var(--text-xs);
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent);
      margin: 0 0 0.35rem 0;
    }
    .hero h1 {
      font-family: var(--font-serif);
      font-size: var(--heading-lg);
      font-weight: 700;
      margin: 0 0 0.75rem 0;
      color: var(--text-primary);
    }
    .hero .intro {
      font-size: var(--text-base);
      color: var(--text-muted);
      line-height: 1.5;
      margin: 0;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.25rem;
      margin-top: 1rem;
    }
    .gallery-card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      display: flex;
      flex-direction: column;
    }
    .gallery-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .gallery-card__grid-wrap {
      aspect-ratio: 1;
      overflow: hidden;
      background: var(--input-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      box-sizing: border-box;
    }
    .gallery-card__grid {
      display: grid;
      gap: 2px;
      width: 100%;
      max-width: 140px;
      height: 100%;
      max-height: 140px;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 3px;
      background: var(--border-light);
    }
    .gallery-card__grid-cell {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6rem;
      font-weight: 700;
      color: var(--text-secondary);
      background: var(--card-bg);
      border-radius: 2px;
      min-height: 0;
    }
    .gallery-card__grid-cell.cell-type--text {
      background: rgba(26, 95, 180, 0.12);
      color: #1a5fb4;
    }
    .gallery-card__grid-cell.cell-type--branding {
      background: rgba(198, 70, 0, 0.12);
      color: #c64600;
    }
    .gallery-card__img-wrap {
      aspect-ratio: 1;
      overflow: hidden;
      background: var(--input-bg);
      position: relative;
    }
    .gallery-card__img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .gallery-card__layout-badge {
      position: absolute;
      bottom: 4px;
      right: 4px;
      font-size: 0.6rem;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(0,0,0,0.7);
      color: #fff;
    }
    .gallery-card__body {
      padding: 0.75rem 1rem;
      flex: 1;
    }
    .gallery-card__badge {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      margin-bottom: 0.35rem;
    }
    .gallery-card__badge--grok {
      background: #e8f0fe;
      color: #1a73e8;
    }
    .gallery-card__badge--gpt {
      background: #e6f4ea;
      color: #0d652d;
    }
    .gallery-card__title {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 0.25rem 0;
      line-height: 1.3;
    }
    .gallery-card__desc {
      font-size: var(--text-xs);
      color: var(--text-muted);
      margin: 0;
      line-height: 1.4;
    }
    .gallery-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .gallery-tab {
      padding: 0.6rem 1rem;
      font-size: var(--text-sm);
      font-weight: 500;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      cursor: pointer;
      color: var(--text-muted);
    }
    .gallery-tab:hover { color: var(--text-secondary); }
    .gallery-tab.is-active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    .gallery-panel {
      display: none;
    }
    .gallery-panel.is-active { display: block; }
    .gallery-panel__hint {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin: 0 0 0.75rem 0;
    }
    .gallery-loading, .gallery-error {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
    }
    .gallery-error { color: var(--error); }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      box-sizing: border-box;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    .modal-overlay.is-open {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      max-width: 560px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .modal__img-wrap {
      flex-shrink: 0;
      max-height: 240px;
      overflow: hidden;
      background: var(--input-bg);
    }
    .modal__img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
      max-height: 240px;
    }
    .modal__body {
      padding: var(--card-padding);
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    .modal__badge {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      margin-bottom: 0.5rem;
    }
    .modal__badge--grok { background: #e8f0fe; color: #1a73e8; }
    .modal__badge--gpt { background: #e6f4ea; color: #0d652d; }
    .modal__title {
      font-size: var(--heading-md);
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 0.5rem 0;
    }
    .modal__meta {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin: 0 0 0.75rem 0;
    }
    .modal__meta strong { color: var(--text-secondary); }
    .modal__desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0 0 1rem 0;
    }
    .modal__prompt-label {
      font-size: var(--text-xs);
      font-weight: 600;
      color: var(--text-hint);
      margin: 0 0 0.35rem 0;
    }
    .modal__prompt {
      width: 100%;
      min-height: 120px;
      padding: 0.75rem;
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      line-height: 1.45;
      border: 1px solid var(--border-input);
      border-radius: var(--radius-input);
      background: var(--input-bg);
      resize: vertical;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    .modal__actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }
    .btn {
      display: inline-block;
      padding: var(--btn-padding);
      background: var(--btn-primary-bg);
      color: #fff;
      border: none;
      border-radius: var(--radius-input);
      cursor: pointer;
      font-size: 1rem;
      text-decoration: none;
      transition: background 0.15s;
    }
    .btn:hover { background: var(--btn-primary-hover); }
    .btn:focus { outline: 2px solid var(--focus-ring); outline-offset: 2px; }
    .btn--accent {
      background: var(--accent);
      color: #1a1a1a;
    }
    .btn--accent:hover { background: #d49245; color: #1a1a1a; }
    .btn-outline {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border-input);
    }
    .btn-outline:hover { background: var(--input-bg); }
    .modal__copy-feedback {
      font-size: var(--text-sm);
      color: var(--success);
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="app-header__inner">
      <a href="index.html" class="app-header__logo">Grid<span class="app-header__logo-num">2</span>Icons</a>
      <a href="index.html" class="app-header__nav">← GRID SPLITTER</a>
      <a href="prompt-builder.html" class="app-header__nav">PROMPT BUILDER →</a>
      <a href="gallery.html" class="app-header__nav">Gallery</a>
      <a href="premium.html" class="app-header__nav">Premium</a>
      <div class="app-header__auth">
        <span id="auth-loading" class="auth-loading">Loading…</span>
        <span id="auth-guest" class="auth-guest" style="display:none;">
          <button type="button" id="auth-btn-login" class="app-header__auth-btn">Sign in</button>
          <span class="app-header__auth-sep" aria-hidden="true">|</span>
          <button type="button" id="auth-btn-signup" class="app-header__auth-btn">Sign up</button>
        </span>
        <div id="auth-user" class="profile-dropdown" style="display:none;">
          <button type="button" id="auth-profile-trigger" class="app-header__auth-btn profile-dropdown__trigger" aria-expanded="false" aria-haspopup="true" aria-controls="auth-profile-menu" title="Account menu">
            <span id="auth-user-initial" class="profile-dropdown__initial" aria-hidden="true"></span>
            <span class="profile-dropdown__chevron" aria-hidden="true">▼</span>
          </button>
          <div id="auth-profile-menu" class="profile-dropdown__menu" role="menu" aria-label="Account menu" hidden>
            <div class="profile-dropdown__email" id="auth-profile-email"></div>
            <a href="premium.html" class="profile-dropdown__link" role="menuitem">Premium</a>
            <button type="button" id="auth-btn-logout" class="profile-dropdown__btn" role="menuitem">Disconnect</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="hero">
      <p class="hero__label" aria-hidden="true">GALLERY</p>
      <h1>Imagine</h1>
      <p class="intro">Browse by grid layouts, image styles, or full examples. Click one to see the prompt and create a similar image.</p>
    </div>

    <div id="gallery-loading" class="gallery-loading">Loading gallery…</div>
    <div id="gallery-error" class="gallery-error" style="display:none;"></div>
    <div id="gallery-tabs-wrap" style="display:none;">
      <div class="gallery-tabs" role="tablist" aria-label="Gallery type">
        <button type="button" class="gallery-tab is-active" role="tab" aria-selected="true" aria-controls="panel-grid" id="tab-grid">Grid layouts</button>
        <button type="button" class="gallery-tab" role="tab" aria-selected="false" aria-controls="panel-style" id="tab-style">Styles</button>
        <button type="button" class="gallery-tab" role="tab" aria-selected="false" aria-controls="panel-example" id="tab-example">Full examples</button>
      </div>
      <div id="panel-grid" class="gallery-panel is-active" role="tabpanel" aria-labelledby="tab-grid">
        <p class="gallery-panel__hint">Numeric grid structures. No example images.</p>
        <div id="gallery-grid" class="gallery-grid"></div>
      </div>
      <div id="panel-style" class="gallery-panel" role="tabpanel" aria-labelledby="tab-style" hidden>
        <p class="gallery-panel__hint">Image style showcase (realistic, minimalist, schematic, etc.).</p>
        <div id="gallery-style" class="gallery-grid"></div>
      </div>
      <div id="panel-example" class="gallery-panel" role="tabpanel" aria-labelledby="tab-example" hidden>
        <p class="gallery-panel__hint">Example images that illustrate grid layouts.</p>
        <div id="gallery-example" class="gallery-grid"></div>
      </div>
    </div>
  </main>

  <div id="modal-overlay" class="modal-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal" role="document">
      <div class="modal__img-wrap">
        <img id="modal-img" class="modal__img" src="" alt="">
      </div>
      <div class="modal__body">
        <span id="modal-badge" class="modal__badge"></span>
        <h2 id="modal-title" class="modal__title"></h2>
        <p id="modal-meta" class="modal__meta"></p>
        <p id="modal-desc" class="modal__desc"></p>
        <p class="modal__prompt-label">Prompt (use as template)</p>
        <textarea id="modal-prompt" class="modal__prompt" readonly></textarea>
        <div class="modal__actions">
          <button type="button" id="modal-create-similar" class="btn btn--accent">Create similar</button>
          <button type="button" id="modal-copy" class="btn btn-outline">Copy prompt</button>
          <span id="modal-copy-feedback" class="modal__copy-feedback" aria-live="polite"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.__GALLERY_FALLBACK__ = [{"id":"grid-2x2","galleries":["grid"],"layout":"2x2","model":"GPT","title":"2×2 Classic","description":"4 cells.","prompt":"Create a 2×2 grid.","size":"2×2"},{"id":"grid-4x4","galleries":["grid"],"layout":"4x4","model":"GPT","title":"4×4 Classic","description":"16 cells.","prompt":"Create a 4×4 grid.","size":"4×4"},{"id":"grok-realistic-1","galleries":["style","example"],"image":"Examples/ChatGPT Image 21 févr. 2026, 15_05_26.png","layout":"4x4","model":"Grok","title":"Realistic landscape grid","description":"Natural scenes in a 4×4 grid with photorealistic style.","prompt":"Create an image in a perfectly aligned 4×4 grid, with thin, sharp black borders between each cell and a pastel background. Uniform style for all 16 illustrations: realistic, clean and precise lines, monochrome colors, fine outlines.","style":"realistic","palette":"monochrome","size":"4×4"},{"id":"gpt-icons-1","galleries":["style","example"],"image":"Examples/ChatGPT Image 21 févr. 2026, 15_10_07.png","layout":"4x4","model":"GPT","title":"Icon set – minimalist","description":"Clean icon grid for UI or app assets.","prompt":"Create an image in a perfectly aligned 4×4 grid with thin black borders and pure white background. Minimalist vector, flat and vivid colors.","style":"minimalist vector","palette":"flat and vivid"},{"id":"gpt-icons-2","galleries":["style","example"],"image":"Examples/Gemini_Generated_Image_zbex2yzbex2yzbex.png","model":"GPT","title":"Icons – soft palette","description":"Soft pastel icon grid.","prompt":"Create a 4×4 grid with soft and pastel colors, minimalist vector style.","style":"minimalist vector","palette":"soft and pastel"}];
  </script>
  <script>
    (function () {
      var GALLERY_KEY = 'galleryPrompt';
      var overlay = document.getElementById('modal-overlay');
      var modalImg = document.getElementById('modal-img');
      var modalBadge = document.getElementById('modal-badge');
      var modalTitle = document.getElementById('modal-title');
      var modalMeta = document.getElementById('modal-meta');
      var modalDesc = document.getElementById('modal-desc');
      var modalPrompt = document.getElementById('modal-prompt');
      var modalCreateSimilar = document.getElementById('modal-create-similar');
      var modalCopy = document.getElementById('modal-copy');
      var modalCopyFeedback = document.getElementById('modal-copy-feedback');
      var galleryGrid = document.getElementById('gallery-grid');
      var galleryStyle = document.getElementById('gallery-style');
      var galleryExample = document.getElementById('gallery-example');
      var galleryLoading = document.getElementById('gallery-loading');
      var galleryError = document.getElementById('gallery-error');
      var galleryTabsWrap = document.getElementById('gallery-tabs-wrap');
      var currentItem = null;

      function inGalleries(item, name) {
        var g = item.galleries;
        if (Array.isArray(g)) return g.indexOf(name) !== -1;
        if (item.gallery === name) return true;
        if (name === 'grid') return !item.image && (item.layout || item.size);
        if (name === 'style' || name === 'example') return !!(item.image && item.style);
        return false;
      }

      function partitionByGalleries(items) {
        var grid = [], style = [], example = [];
        items.forEach(function (item) {
          if (inGalleries(item, 'grid')) grid.push(item);
          if (inGalleries(item, 'style')) style.push(item);
          if (inGalleries(item, 'example')) example.push(item);
        });
        return { grid: grid, style: style, example: example };
      }

      function getLayoutKey(item) {
        if (item.layout) return item.layout;
        if (item.gridPreset) return item.gridPreset;
        if (item.size) {
          var s = String(item.size).replace(/×/g, 'x').replace(/\s/g, '');
          if (/^\d+x\d+$/i.test(s)) return s;
        }
        return '4x4';
      }

      function renderGridPreview(layoutKey) {
        var wrap = document.createElement('div');
        wrap.className = 'gallery-card__grid-wrap';
        var grid = document.createElement('div');
        grid.className = 'gallery-card__grid';
        var spec = (typeof gridSchema !== 'undefined' && gridSchema.parseCompactGrid)
          ? gridSchema.parseCompactGrid(layoutKey)
          : { mode: 'uniform', rows: 4, cols: 4, cells: [] };
        spec = (typeof gridSchema !== 'undefined' && gridSchema.normalizeSpec)
          ? gridSchema.normalizeSpec(spec)
          : spec;
        var rows = spec.rows || 1;
        var cols = spec.cols || 1;
        grid.style.gridTemplateColumns = 'repeat(' + cols + ', 1fr)';
        grid.style.gridTemplateRows = 'repeat(' + rows + ', 1fr)';
        var cells = spec.cells && spec.cells.length ? spec.cells : [];
        if (!cells.length) {
          for (var r = 0; r < rows; r++) {
            for (var c = 0; c < cols; c++) {
              cells.push({ row: r, col: c, rowSpan: 1, colSpan: 1 });
            }
          }
          cells.sort(function (a, b) { return a.row !== b.row ? a.row - b.row : a.col - b.col; });
        }
        for (var i = 0; i < cells.length; i++) {
          var ce = cells[i];
          var cellEl = document.createElement('div');
          cellEl.className = 'gallery-card__grid-cell';
          var cellType = (ce && ce.cellType) ? ce.cellType : 'image';
          cellEl.classList.add('cell-type--' + cellType);
          var label = cellType === 'text' ? 'TXT' : cellType === 'branding' ? 'B' : (i + 1);
          cellEl.textContent = label;
          if (ce.row != null && ce.col != null) {
            cellEl.style.gridRowStart = (ce.row + 1);
            cellEl.style.gridColumnStart = (ce.col + 1);
            cellEl.style.gridRowEnd = 'span ' + (ce.rowSpan || 1);
            cellEl.style.gridColumnEnd = 'span ' + (ce.colSpan || 1);
          }
          grid.appendChild(cellEl);
        }
        wrap.appendChild(grid);
        return wrap;
      }

      function renderCardGrid(item) {
        var card = document.createElement('button');
        card.type = 'button';
        card.className = 'gallery-card';
        card.setAttribute('data-id', item.id);
        var badgeClass = item.model === 'Grok' ? 'gallery-card__badge--grok' : 'gallery-card__badge--gpt';
        var layoutKey = getLayoutKey(item);
        card.appendChild(renderGridPreview(layoutKey));
        var body = document.createElement('div');
        body.className = 'gallery-card__body';
        body.innerHTML =
          '<span class="gallery-card__badge ' + badgeClass + '">' + escapeHtml(item.model) + '</span>' +
          '<p class="gallery-card__title">' + escapeHtml(item.title) + '</p>' +
          '<p class="gallery-card__desc">' + escapeHtml(item.description) + '</p>';
        card.appendChild(body);
        card.addEventListener('click', function () { openModal(item); });
        return card;
      }

      function renderCardStyle(item) {
        var card = document.createElement('button');
        card.type = 'button';
        card.className = 'gallery-card';
        card.setAttribute('data-id', item.id);
        var badgeClass = item.model === 'Grok' ? 'gallery-card__badge--grok' : 'gallery-card__badge--gpt';
        var imgSrc = (item.image && typeof item.image === 'string') ? item.image : '';
        try { imgSrc = encodeURI(imgSrc); } catch (e) { imgSrc = ''; }
        imgSrc = escapeHtml(imgSrc);
        var wrap = document.createElement('div');
        wrap.className = 'gallery-card__img-wrap';
        wrap.innerHTML = '<img class="gallery-card__img" src="' + imgSrc + '" alt="" loading="lazy">';
        card.appendChild(wrap);
        var body = document.createElement('div');
        body.className = 'gallery-card__body';
        body.innerHTML =
          '<span class="gallery-card__badge ' + badgeClass + '">' + escapeHtml(item.model) + '</span>' +
          '<p class="gallery-card__title">' + escapeHtml(item.title) + '</p>' +
          '<p class="gallery-card__desc">' + escapeHtml(item.description) + '</p>';
        card.appendChild(body);
        card.addEventListener('click', function () { openModal(item); });
        return card;
      }

      function renderCardExample(item) {
        var card = document.createElement('button');
        card.type = 'button';
        card.className = 'gallery-card';
        card.setAttribute('data-id', item.id);
        var badgeClass = item.model === 'Grok' ? 'gallery-card__badge--grok' : 'gallery-card__badge--gpt';
        var layoutKey = getLayoutKey(item);
        var imgSrc = (item.image && typeof item.image === 'string') ? item.image : '';
        try { imgSrc = encodeURI(imgSrc); } catch (e) { imgSrc = ''; }
        imgSrc = escapeHtml(imgSrc);
        var wrap = document.createElement('div');
        wrap.className = 'gallery-card__img-wrap';
        wrap.innerHTML =
          '<img class="gallery-card__img" src="' + imgSrc + '" alt="" loading="lazy">' +
          '<span class="gallery-card__layout-badge">' + escapeHtml(layoutKey) + '</span>';
        card.appendChild(wrap);
        var body = document.createElement('div');
        body.className = 'gallery-card__body';
        body.innerHTML =
          '<span class="gallery-card__badge ' + badgeClass + '">' + escapeHtml(item.model) + '</span>' +
          '<p class="gallery-card__title">' + escapeHtml(item.title) + '</p>' +
          '<p class="gallery-card__desc">' + escapeHtml(item.description) + '</p>';
        card.appendChild(body);
        card.addEventListener('click', function () { openModal(item); });
        return card;
      }

      function escapeHtml(s) {
        if (!s) return '';
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }

      function openModal(item) {
        currentItem = item;
        var hasImage = !!(item.image && String(item.image).trim());
        var imgWrap = modalImg && modalImg.parentElement;
        if (imgWrap) imgWrap.style.display = hasImage ? '' : 'none';
        if (hasImage) {
          try {
            modalImg.src = item.image ? encodeURI(item.image) : '';
          } catch (e) {
            modalImg.src = item.image || '';
          }
          modalImg.alt = item.title;
        }
        modalBadge.textContent = item.model;
        modalBadge.className = 'modal__badge modal__badge--' + (item.model === 'Grok' ? 'grok' : 'gpt');
        modalTitle.textContent = item.title;
        var metaParts = [];
        if (item.size) metaParts.push('<strong>Size:</strong> ' + escapeHtml(item.size));
        if (item.style) metaParts.push('<strong>Style:</strong> ' + escapeHtml(item.style));
        if (item.background) metaParts.push('<strong>Background:</strong> ' + escapeHtml(item.background));
        if (item.palette) metaParts.push('<strong>Palette:</strong> ' + escapeHtml(item.palette));
        if (item.outlines) metaParts.push('<strong>Outlines:</strong> ' + escapeHtml(item.outlines));
        if (item.labels) metaParts.push('<strong>Labels:</strong> ' + escapeHtml(item.labels));
        if (item.anthropomorphism) metaParts.push('<strong>Anthropomorphism:</strong> ' + escapeHtml(item.anthropomorphism));
        if (item.lumiere) metaParts.push('<strong>Lumière:</strong> ' + escapeHtml(item.lumiere));
        if (item.couleursMax != null && item.couleursMax !== '') metaParts.push('<strong>Couleurs max:</strong> ' + escapeHtml(String(item.couleursMax)));
        if (item.mood) metaParts.push('<strong>Mood:</strong> ' + escapeHtml(item.mood));
        modalMeta.innerHTML = metaParts.length ? metaParts.join(' &middot; ') : '';
        modalDesc.textContent = item.description;
        modalPrompt.value = item.prompt || '';
        modalCopyFeedback.textContent = '';
        overlay.classList.add('is-open');
        overlay.setAttribute('aria-hidden', 'false');
      }

      function closeModal() {
        overlay.classList.remove('is-open');
        overlay.setAttribute('aria-hidden', 'true');
        currentItem = null;
      }

      overlay.addEventListener('click', function (e) {
        if (e.target === overlay) closeModal();
      });
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && overlay.classList.contains('is-open')) closeModal();
      });

      modalCreateSimilar.addEventListener('click', function () {
        if (!currentItem || !currentItem.prompt) return;
        try {
          sessionStorage.setItem(GALLERY_KEY, currentItem.prompt);
          window.location.href = 'prompt-builder.html';
        } catch (err) {
          modalCopyFeedback.textContent = 'Could not open Prompt Builder. Copy the prompt instead.';
        }
      });

      modalCopy.addEventListener('click', function () {
        if (!modalPrompt.value) return;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(modalPrompt.value).then(function () {
            modalCopyFeedback.textContent = 'Copied!';
            setTimeout(function () { modalCopyFeedback.textContent = ''; }, 2000);
          }).catch(function () {
            modalCopyFeedback.textContent = 'Copy failed.';
          });
        } else {
          modalPrompt.select();
          try {
            document.execCommand('copy');
            modalCopyFeedback.textContent = 'Copied!';
            setTimeout(function () { modalCopyFeedback.textContent = ''; }, 2000);
          } catch (e) {
            modalCopyFeedback.textContent = 'Select and copy manually.';
          }
        }
      });

      function showGallery(items) {
          galleryLoading.style.display = 'none';
          galleryError.style.display = 'none';
          if (!items || !items.length) {
            galleryError.textContent = 'No grids in gallery yet.';
            galleryError.style.display = 'block';
            return;
          }
          var parts = partitionByGalleries(items);
          galleryGrid.innerHTML = '';
          galleryStyle.innerHTML = '';
          galleryExample.innerHTML = '';
          parts.grid.forEach(function (item) { galleryGrid.appendChild(renderCardGrid(item)); });
          parts.style.forEach(function (item) { galleryStyle.appendChild(renderCardStyle(item)); });
          parts.example.forEach(function (item) { galleryExample.appendChild(renderCardExample(item)); });
          galleryTabsWrap.style.display = 'block';
        }

      function switchTab(panelId) {
          document.querySelectorAll('.gallery-tab').forEach(function (t) {
            t.classList.remove('is-active');
            t.setAttribute('aria-selected', 'false');
          });
          document.querySelectorAll('.gallery-panel').forEach(function (p) {
            p.classList.remove('is-active');
            p.hidden = true;
          });
          var tab = document.getElementById('tab-' + (panelId === 'panel-grid' ? 'grid' : panelId === 'panel-style' ? 'style' : 'example'));
          var panel = document.getElementById(panelId);
          if (tab) { tab.classList.add('is-active'); tab.setAttribute('aria-selected', 'true'); }
          if (panel) { panel.classList.add('is-active'); panel.hidden = false; }
        }
      document.getElementById('tab-grid').addEventListener('click', function () { switchTab('panel-grid'); });
      document.getElementById('tab-style').addEventListener('click', function () { switchTab('panel-style'); });
      document.getElementById('tab-example').addEventListener('click', function () { switchTab('panel-example'); });

      fetch('data/gallery-grids.json')
        .then(function (res) {
          if (!res.ok) throw new Error('Failed to load gallery');
          return res.json();
        })
        .then(function (items) {
          showGallery(items);
        })
        .catch(function (err) {
          if (window.__GALLERY_FALLBACK__ && window.__GALLERY_FALLBACK__.length) {
            showGallery(window.__GALLERY_FALLBACK__);
            return;
          }
          galleryLoading.style.display = 'none';
          galleryError.textContent = err.message || 'Could not load gallery.';
          galleryError.style.display = 'block';
        });
    })();
  </script>
  <script src="js/auth0-config.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script src="js/auth-ui.js"></script>
</body>
</html>
